{{/* HTTP/2 Server Push Configuration */}}

{{/* Critical resources for HTTP/2 push */}}
{{ if hugo.IsProduction }}
  <!-- HTTP/2 Server Push for critical resources -->
  <link rel="preload" href="{{ .Site.BaseURL }}css/critical.css" as="style">
  <link rel="preload" href="{{ .Site.BaseURL }}css/tailwind.css" as="style">
  <link rel="preload" href="{{ .Site.BaseURL }}js/lazy-loading.js" as="script">
  <!-- Logo will be loaded when needed -->
  
  <!-- Push critical CSS -->
  <link rel="preload" href="{{ .Site.BaseURL }}css/critical.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/critical.css"></noscript>
  
  <!-- Push critical JavaScript -->
  <link rel="preload" href="{{ .Site.BaseURL }}js/lazy-loading.js" as="script">
  <link rel="preload" href="{{ .Site.BaseURL }}js/analytics-enhanced.js" as="script">
  
  <!-- Push critical images - only preload if actually used -->
  {{ if .IsHome }}
  <link rel="preload" href="{{ .Site.BaseURL }}images/webp/hero-backwaters.webp" as="image">
  {{ end }}
{{ end }}

{{/* Service Worker for HTTP/2 push fallback */}}
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/sw.js')
        .then(function(registration) {
          console.log('Service Worker registered successfully:', registration.scope);
          
          // Enable HTTP/2 push for critical resources
          if (registration.active) {
            registration.active.postMessage({
              type: 'PUSH_RESOURCES',
              resources: [
                '/css/critical.css',
                '/css/tailwind.css',
                '/js/lazy-loading.js',
                '/images/webp/logo.webp',
                '/images/webp/hero-backwaters.webp'
              ]
            });
          }
        })
        .catch(function(error) {
          console.log('Service Worker registration failed:', error);
        });
    });
  }
</script>
