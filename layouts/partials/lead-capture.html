{{/*
  Lead capture form with travel guide download
  Usage: {{ partial "lead-capture.html" . }}
*/}}
<div class="bg-gradient-to-r from-yellow-50 to-green-50 border border-yellow-200 rounded-lg p-6 md:p-8">
  <div class="text-center mb-6">
    <h3 class="text-2xl font-bold text-gray-800 mb-2">Kostenloser Kerala Reiseführer</h3>
    <p class="text-gray-600">Erhalten Sie unseren 15-seitigen Guide mit Insider-Tipps, Packliste und Ayurveda-Basics per E-Mail.</p>
  </div>
  
  <form id="leadCaptureForm" class="space-y-4" onsubmit="return handleLeadCapture(event)">
    <div class="grid md:grid-cols-2 gap-4">
      <input 
        type="text" 
        name="firstName" 
        placeholder="Vorname" 
        required 
        class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
      >
      <input 
        type="text" 
        name="lastName" 
        placeholder="Nachname" 
        required 
        class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
      >
    </div>
    
    <input 
      type="email" 
      name="email" 
      placeholder="E-Mail-Adresse" 
      required 
      class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
    >
    
    <div class="flex items-start gap-3">
      <input 
        type="checkbox" 
        name="newsletter" 
        id="newsletter" 
        class="mt-1 h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded"
      >
      <label for="newsletter" class="text-sm text-gray-600">
        Ich möchte auch über neue Reiseangebote und Ayurveda-Tipps informiert werden (kann jederzeit abbestellt werden)
      </label>
    </div>
    
    <button 
      type="submit" 
      class="w-full bg-yellow-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-yellow-700 transition-colors duration-200 flex items-center justify-center gap-2"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg>
      Reiseführer kostenlos herunterladen
    </button>
    
    <p class="text-xs text-gray-500 text-center">
      Datenschutzkonform • Keine Weitergabe an Dritte • Jederzeit abbestellbar
    </p>
  </form>
  
  <div id="successMessage" class="hidden text-center py-4">
    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg">
      <p class="font-semibold">Vielen Dank!</p>
      <p>Ihr Reiseführer wurde an Ihre E-Mail-Adresse gesendet.</p>
    </div>
  </div>
</div>

<script>
function handleLeadCapture(e) {
  e.preventDefault();
  
  const form = document.getElementById('leadCaptureForm');
  const formData = new FormData(form);
  const data = {
    firstName: formData.get('firstName'),
    lastName: formData.get('lastName'),
    email: formData.get('email'),
    newsletter: formData.get('newsletter') === 'on',
    source: 'Website Lead Capture',
    timestamp: new Date().toISOString()
  };
  
  // Show loading state
  const submitBtn = form.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Wird gesendet...';
  submitBtn.disabled = true;
  
  // Send email using EmailJS
  emailjs.send('service_6n7cbrb', 'template_reisefuehrer', {
    to_email: data.email,
    to_name: `${data.firstName} ${data.lastName}`,
    from_name: 'Ayurveda Kerala Team',
    reply_to: 'sebastiantinu9493@gmail.com',
    user_email: data.email,
    user_name: `${data.firstName} ${data.lastName}`
  })
  .then(function(response) {
    console.log('SUCCESS!', response.status, response.text);
    
    // Show success message
    form.style.display = 'none';
    document.getElementById('successMessage').classList.remove('hidden');
    
    // Optional: Send lead notification to WhatsApp (silent, no redirect)
    const message = `Neue Reiseführer-Anfrage:
Name: ${data.firstName} ${data.lastName}
E-Mail: ${data.email}
Newsletter: ${data.newsletter ? 'Ja' : 'Nein'}
Quelle: Website Lead Capture

E-Mail wurde automatisch versendet.`;
    
    // Uncomment the line below if you want WhatsApp notifications (no redirect)
    // const whatsappUrl = `https://wa.me/{{ .Site.Params.whatsapp.number }}?text=${encodeURIComponent(message)}`;
    // window.open(whatsappUrl, '_blank');
    
  }, function(error) {
    console.log('FAILED...', error);
    
    // Show error message
    const errorDiv = document.createElement('div');
    errorDiv.className = 'bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mt-4';
    errorDiv.innerHTML = '<p class="font-semibold">Fehler beim Senden</p><p>Bitte versuchen Sie es erneut oder kontaktieren Sie uns direkt per WhatsApp.</p>';
    form.appendChild(errorDiv);
    
    // Reset button
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  });
  
  return false;
}
</script>

<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script type="text/javascript">
  (function(){
    emailjs.init("JAtr_sIlUlFAvciuj"); // Replace with your EmailJS public key
  })();
</script>
