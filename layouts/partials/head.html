<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{{ if .Title }}{{ .Title }} | Ayurveda Kerala{{ else }}Ayurveda Kerala – Reisen & Ayurveda-Kuren{{ end }}</title>
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}Ayurveda-Reisen, Yoga-Retreats und Rundreisen in Kerala, Indien.{{ end }}">
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>

  <link rel="icon" href="{{ .Site.Params.favicon }}" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Klaro! Cookie Consent -->
  <link rel="stylesheet" type="text/css" href="https://cdn.kiprotect.com/klaro/latest/klaro.css"/>
  <script type="text/javascript" src="/js/klaro-config.js"></script>
  <script type="text/javascript" src="https://cdn.kiprotect.com/klaro/latest/klaro.js"></script>

  <!-- Google Analytics (wrapped by Klaro) -->
  {{ with .Site.Params.googleAnalytics }}
  <script type="text/plain" data-type="application/javascript" data-name="google-analytics">
    (function(){
      var gaId = '{{ . }}';
      var gtagScript = document.createElement('script');
      gtagScript.async = true;
      gtagScript.src = 'https://www.googletagmanager.com/gtag/js?id=' + gaId;
      document.head.appendChild(gtagScript);

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', gaId, {
        custom_map: {
          'custom_parameter_1': 'page_category',
          'custom_parameter_2': 'user_type'
        }
      });
      
      // Enhanced ecommerce tracking
      gtag('config', gaId, {
        send_page_view: true,
        enhanced_ecommerce: true
      });
    })();
  </script>
  {{ end }}

  {{- $org := dict "@context" "https://schema.org" "@type" "Organization" "name" "Ayurveda Kerala" "url" .Site.BaseURL "logo" (printf "%simages/logo.png" .Site.BaseURL) "contactPoint" (dict "@type" "ContactPoint" "telephone" (printf "+%s" (default "4915233145220" .Site.Params.whatsapp.number)) "contactType" "customer service" "areaServed" "DE" "availableLanguage" "German") "sameAs" (slice "https://www.facebook.com/ayurvedakerala" "https://www.instagram.com/ayurvedakerala") -}}
  <script type="application/ld+json">{{ $org | jsonify | safeHTML }}</script>

  {{- $lb := dict "@context" "https://schema.org" "@type" "LocalBusiness" "name" "Ayurveda Kerala" "image" (printf "%simages/logo.png" .Site.BaseURL) "address" (dict "@type" "PostalAddress" "streetAddress" "Hauptstraße 12" "addressLocality" "Leonberg" "postalCode" "71229" "addressCountry" "DE") "telephone" (printf "+%s" (default "4915233145220" .Site.Params.whatsapp.number)) "priceRange" "$$" "openingHours" "Mo-Fr 09:00-18:00,Sa 10:00-14:00" -}}
  <script type="application/ld+json">{{ $lb | jsonify | safeHTML }}</script>

  {{- $service := dict "@context" "https://schema.org" "@type" "Service" "name" "Ayurveda Reisen Kerala" "description" "Deutschsprachige Beratung für Ayurveda-Kuren, Yoga-Retreats und Rundreisen in Kerala, Indien" "provider" (dict "@type" "Organization" "name" "Ayurveda Kerala") "areaServed" (dict "@type" "Country" "name" "Deutschland") "serviceType" "Reiseberatung" "offers" (dict "@type" "Offer" "priceCurrency" "EUR" "availability" "https://schema.org/InStock") -}}
  <script type="application/ld+json">{{ $service | jsonify | safeHTML }}</script>

  <link rel="icon" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">

  <!-- Open Graph -->
  <meta property="og:title" content="{{ if .Title }}{{ .Title }} | Ayurveda Kerala{{ else }}Ayurveda Kerala – Reisen & Ayurveda-Kuren{{ end }}" />
  <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}Authentische Ayurveda- & Kerala-Reisen aus Deutschland{{ end }}" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="{{ .Permalink }}" />
  <meta property="og:image" content="{{ with .Params.image }}{{ . | relURL }}{{ else }}{{ with .Site.Params.defaultImage }}{{ . | relURL }}{{ else }}/images/hero-backwaters.jpg{{ end }}{{ end }}" />
  <meta property="og:image:alt" content="{{ .Title }}" />
  <meta property="og:site_name" content="Ayurveda Kerala" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ if .Title }}{{ .Title }} | Ayurveda Kerala{{ else }}Ayurveda Kerala – Reisen & Ayurveda-Kuren{{ end }}" />
  <meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}Authentische Ayurveda- & Kerala-Reisen aus Deutschland{{ end }}" />
  <meta name="twitter:image" content="{{ with .Params.image }}{{ . | relURL }}{{ else }}{{ with .Site.Params.defaultImage }}{{ . | relURL }}{{ else }}/images/hero-backwaters.jpg{{ end }}{{ end }}" />

  <!-- Crisp Chat -->
  <script type="text/javascript">
  window.$crisp = [];
  window.CRISP_WEBSITE_ID = "b96ad9f7-853f-4c78-a0e6-a7eaa36eab93";
  (function() {
      d = document;
      s = d.createElement("script");
      s.src = "https://client.crisp.chat/l.js";
      s.async = 1;
      d.getElementsByTagName("head")[0].appendChild(s);
  })();
  </script>

  <!-- Advanced Analytics & Conversion Tracking -->
  <script>
  // Enhanced conversion tracking
  function trackConversion(eventName, value, currency = 'EUR') {
    if (typeof gtag !== 'undefined') {
      gtag('event', eventName, {
        'event_category': 'conversion',
        'event_label': eventName,
        'value': value,
        'currency': currency
      });
    }
  }
  
  // Track user interactions
  document.addEventListener('DOMContentLoaded', function() {
    // Track form submissions
    document.addEventListener('submit', function(e) {
      if (e.target.id === 'leadCaptureForm') {
        trackConversion('lead_capture', 1);
      } else if (e.target.id === 'contactForm') {
        trackConversion('contact_form', 1);
      } else if (e.target.id === 'quickBookingForm') {
        trackConversion('booking_inquiry', 1);
      }
    });
    
    // Track button clicks
    document.addEventListener('click', function(e) {
      if (e.target.matches('a[href*="wa.me"]')) {
        trackConversion('whatsapp_click', 1);
      } else if (e.target.matches('a[href*="/kontakt/"]')) {
        trackConversion('contact_page_click', 1);
      } else if (e.target.matches('a[href*="/reisen/"]')) {
        trackConversion('tour_page_click', 1);
      }
    });
    
    // Track scroll depth
    let maxScroll = 0;
    window.addEventListener('scroll', function() {
      const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
      if (scrollPercent > maxScroll && scrollPercent % 25 === 0) {
        maxScroll = scrollPercent;
        trackConversion('scroll_depth_' + scrollPercent, 1);
      }
    });
    
    // Track time on page
    let startTime = Date.now();
    window.addEventListener('beforeunload', function() {
      const timeOnPage = Math.round((Date.now() - startTime) / 1000);
      trackConversion('time_on_page', timeOnPage);
    });
  });
  </script>

  <link rel="canonical" href="{{ .Site.BaseURL }}{{ .RelPermalink }}">
  <link rel="alternate" hreflang="de" href="{{ .Permalink }}" />
  <link rel="alternate" hreflang="x-default" href="{{ .Permalink }}" />
  {{- if eq .Kind "home" -}}
  <script type="application/ld+json">
  {{- $website := dict "@context" "https://schema.org" "@type" "WebSite" "url" .Site.BaseURL "name" "Ayurveda Kerala" "potentialAction" (dict "@type" "SearchAction" "target" (printf "%s?q={search_term_string}" .Site.BaseURL) "query-input" "required name=search_term_string") -}}
  {{ $website | jsonify | safeHTML }}
  </script>
  {{- end -}}
  <link rel="preload" href="/css/custom.css" as="style">
  <link rel="stylesheet" href="/css/custom.css">

</head>
