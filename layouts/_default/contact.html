{{ define "main" }}
<section class="max-w-4xl mx-auto pt-1 pb-3 px-4">
  <div class="bg-white rounded-lg shadow p-6 md:p-8">
    <h1 class="text-3xl font-bold mb-2">{{ .Title }}</h1>
    <p class="text-gray-700 mb-6">Deutschsprachige Beratung, schnelle RÃ¼ckmeldung und individuelle ReisevorschlÃ¤ge.</p>

    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <h3 class="font-semibold mb-2">Kontakt</h3>
        <p><strong>Kerala Reisen</strong><br>MeyerhofstraÃŸe 9<br>24106 Kiel<br>Deutschland</p>

        <div class="mt-4">
          <a href="https://wa.me/{{ .Site.Params.whatsapp.number }}" target="_blank" class="inline-flex items-center gap-2 bg-[#25D366] text-white font-semibold px-4 py-2 rounded-lg shadow hover:bg-green-500 transition">ðŸ’¬ WhatsApp</a>
        </div>
      </div>

      <div>
        <h3 class="font-semibold mb-2">Schnellanfrage</h3>
        <form id="contactForm" class="space-y-3">
          <input type="text" name="name" placeholder="Ihr Name" class="w-full border border-gray-300 rounded px-3 py-2" required>
          <input type="email" name="email" placeholder="Ihre E-Mail-Adresse" class="w-full border border-gray-300 rounded px-3 py-2" required>
          <input type="text" name="topic" placeholder="Thema (z. B. Ayurveda-Kur 14 Tage)" class="w-full border border-gray-300 rounded px-3 py-2">
          <textarea name="message" placeholder="Ihre Nachricht" class="w-full border border-gray-300 rounded px-3 py-2" rows="4" required></textarea>
          <button type="submit" class="bg-yellow-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-yellow-700 w-full">
            <span id="submitText">Nachricht senden</span>
            <span id="loadingText" class="hidden">Wird gesendet...</span>
          </button>
          <div id="successMessage" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
            <strong>Vielen Dank!</strong> Ihre Nachricht wurde erfolgreich gesendet. Wir melden uns innerhalb von 1-3 Stunden bei Ihnen.
          </div>
          <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
            <strong>Fehler!</strong> Bitte versuchen Sie es erneut oder kontaktieren Sie uns direkt per WhatsApp.
          </div>
        </form>
      </div>
    </div>

    <hr class="my-8">
    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <h3 class="font-semibold mb-2">BÃ¼rozeiten</h3>
        <p>Moâ€“Fr: 09:00â€“18:00 Uhr<br>Sa: 10:00â€“14:00 Uhr</p>
      </div>
      <div>
        <h3 class="font-semibold mb-2">Anfahrt</h3>
        <a href="https://maps.google.com/?q=MeyerhofstraÃŸe%209%2024106%20Kiel" target="_blank" class="block">
          {{ partial "picture.html" (dict "src" "/images/kerala-office.jpg" "alt" "BÃ¼ro" "class" "w-full h-40 object-cover rounded" "loading" "lazy") }}
          <span class="text-sm text-yellow-700 hover:underline">Auf Google Maps Ã¶ffnen</span>
        </a>
      </div>
    </div>
  </div>

  <p class="text-sm text-gray-600 text-center mt-4">Oder nutzen Sie den Live-Chat (unten rechts) fÃ¼r eine schnelle RÃ¼ckfrage.</p>
</section>

<script>
  // EmailJS is already loaded in head.html

  document.getElementById('contactForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submitText');
    const loadingBtn = document.getElementById('loadingText');
    const successMsg = document.getElementById('successMessage');
    const errorMsg = document.getElementById('errorMessage');
    
    // Show loading state
    submitBtn.classList.add('hidden');
    loadingBtn.classList.remove('hidden');
    successMsg.classList.add('hidden');
    errorMsg.classList.add('hidden');
    
    // Get form data
    const formData = new FormData(this);
    const templateParams = {
      from_name: formData.get('name'),
      from_email: formData.get('email'),
      subject: `Kontaktanfrage: ${formData.get('topic') || 'Allgemeine Anfrage'}`,
      message: formData.get('message')
    };
    
    // Check if EmailJS is loaded
    if (typeof emailjs === 'undefined') {
      console.error('EmailJS not loaded');
      errorMsg.classList.remove('hidden');
      submitBtn.classList.remove('hidden');
      loadingBtn.classList.add('hidden');
      return;
    }
    
    console.log('Sending email with params:', templateParams);
    
    // Send email using contact template
    emailjs.send('service_6n7cbrb', 'template_contact', {
      from_name: templateParams.from_name,
      from_email: templateParams.from_email,
      subject: templateParams.subject,
      message: `${templateParams.message}

---
Diese Nachricht wurde Ã¼ber das Kontaktformular auf ayurveda-kerala.de gesendet.`
    })
      .then(function(response) {
        console.log('SUCCESS!', response.status, response.text);
        // Show success message
        submitBtn.classList.remove('hidden');
        loadingBtn.classList.add('hidden');
        successMsg.classList.remove('hidden');
        
        // Reset form
        document.getElementById('contactForm').reset();
      })
      .catch(function(error) {
        console.error('EmailJS Error:', error);
        console.error('Error details:', {
          status: error.status,
          text: error.text,
          message: error.message
        });
        
        // Show error message
        submitBtn.classList.remove('hidden');
        loadingBtn.classList.add('hidden');
        errorMsg.classList.remove('hidden');
        
        // Log specific error for debugging
        if (error.status === 400) {
          console.error('Bad Request - Check template variables');
        } else if (error.status === 401) {
          console.error('Unauthorized - Check EmailJS public key');
        } else if (error.status === 403) {
          console.error('Forbidden - Check EmailJS service configuration');
        } else if (error.message && error.message.includes('Failed to fetch')) {
          console.error('Network Error - EmailJS service unreachable');
        }
      });
  });
</script>
{{ end }}
