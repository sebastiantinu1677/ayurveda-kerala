{{ define "main" }}
<section class="max-w-6xl mx-auto py-12 px-4">
  <h1 class="text-3xl font-bold mb-8">Unsere Reisen</h1>
  
  <!-- Filter System -->
  <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
    <h2 class="text-lg font-semibold mb-4">Reisen filtern</h2>
    <div class="grid md:grid-cols-4 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Kategorie</label>
        <select id="categoryFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Kategorien</option>
          <option value="ayurveda">Ayurveda-Kuren</option>
          <option value="yoga">Yoga-Retreats</option>
          <option value="rundreise">Rundreisen</option>
          <option value="wellness">Wellness</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Dauer</label>
        <select id="durationFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Dauer</option>
          <option value="7">7 Tage</option>
          <option value="14">14 Tage</option>
          <option value="21">21 Tage</option>
          <option value="28">28+ Tage</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Preis</label>
        <select id="priceFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Preise</option>
          <option value="0-1000">bis 1.000€</option>
          <option value="1000-2000">1.000€ - 2.000€</option>
          <option value="2000-3000">2.000€ - 3.000€</option>
          <option value="3000+">ab 3.000€</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Saison</label>
        <select id="seasonFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Jahreszeiten</option>
          <option value="winter">Winter (Dez-Feb)</option>
          <option value="spring">Frühling (Mär-Mai)</option>
          <option value="summer">Sommer (Jun-Aug)</option>
          <option value="autumn">Herbst (Sep-Nov)</option>
        </select>
      </div>
    </div>
    
    <div class="mt-4 flex justify-between items-center">
      <button id="clearFilters" class="text-gray-500 hover:text-gray-700 text-sm">Filter zurücksetzen</button>
      <span id="resultCount" class="text-sm text-gray-600">{{ len .Pages }} Reisen gefunden</span>
    </div>
  </div>
  
  <!-- Tours Grid -->
  <div id="toursGrid" class="grid md:grid-cols-3 gap-8">
    {{ range .Pages }}
      <div class="tour-card bg-white rounded-lg shadow hover:shadow-lg transition" 
           data-category="{{ .Params.categories | default (slice) | jsonify }}"
           data-duration="{{ .Params.duration }}"
           data-price="{{ .Params.pricefrom }}"
           data-season="{{ .Params.bestSeason }}">
        <a href="{{ .RelPermalink }}" class="block">
          {{ with .Params.image }}
            {{ partial "picture.html" (dict "src" . "alt" $.Title "class" "w-full h-40 object-cover rounded-t-lg" "loading" "lazy") }}
          {{ end }}
          <div class="p-4">
            <h2 class="text-xl font-semibold mb-2">{{ .Title }}</h2>
            <p class="text-gray-600 text-sm mb-3">{{ .Description }}</p>
            
            <!-- Tour Details -->
            <div class="flex flex-wrap gap-2 mb-3">
              {{ with .Params.duration }}
                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">{{ . }}</span>
              {{ end }}
              {{ with .Params.pricefrom }}
                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">{{ . }}€ p.P.</span>
              {{ end }}
              {{ with .Params.categories }}
                {{ range first 1 . }}
                  <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded">{{ . }}</span>
                {{ end }}
              {{ end }}
            </div>
            
            <div class="text-yellow-600 font-semibold text-sm">
              Mehr erfahren →
            </div>
          </div>
        </a>
      </div>
    {{ end }}
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const categoryFilter = document.getElementById('categoryFilter');
  const durationFilter = document.getElementById('durationFilter');
  const priceFilter = document.getElementById('priceFilter');
  const seasonFilter = document.getElementById('seasonFilter');
  const clearFilters = document.getElementById('clearFilters');
  const resultCount = document.getElementById('resultCount');
  const toursGrid = document.getElementById('toursGrid');
  const tourCards = document.querySelectorAll('.tour-card');
  
  function filterTours() {
    const category = categoryFilter.value.toLowerCase();
    const duration = durationFilter.value;
    const price = priceFilter.value;
    const season = seasonFilter.value;
    
    let visibleCount = 0;
    
    tourCards.forEach(card => {
      let show = true;
      
      // Category filter
      if (category) {
        const cardCategories = JSON.parse(card.dataset.category || '[]');
        show = show && cardCategories.some(cat => cat.toLowerCase().includes(category));
      }
      
      // Duration filter
      if (duration && show) {
        const cardDuration = card.dataset.duration;
        if (duration === '7') show = show && cardDuration && cardDuration.includes('7');
        else if (duration === '14') show = show && cardDuration && cardDuration.includes('14');
        else if (duration === '21') show = show && cardDuration && cardDuration.includes('21');
        else if (duration === '28') show = show && cardDuration && parseInt(cardDuration) >= 28;
      }
      
      // Price filter
      if (price && show) {
        const cardPrice = parseInt(card.dataset.price) || 0;
        if (price === '0-1000') show = show && cardPrice <= 1000;
        else if (price === '1000-2000') show = show && cardPrice > 1000 && cardPrice <= 2000;
        else if (price === '2000-3000') show = show && cardPrice > 2000 && cardPrice <= 3000;
        else if (price === '3000+') show = show && cardPrice > 3000;
      }
      
      // Season filter
      if (season && show) {
        const cardSeason = card.dataset.season;
        show = show && cardSeason && cardSeason.toLowerCase().includes(season);
      }
      
      if (show) {
        card.style.display = 'block';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });
    
    resultCount.textContent = `${visibleCount} Reisen gefunden`;
  }
  
  // Event listeners
  [categoryFilter, durationFilter, priceFilter, seasonFilter].forEach(filter => {
    filter.addEventListener('change', filterTours);
  });
  
  clearFilters.addEventListener('click', function() {
    categoryFilter.value = '';
    durationFilter.value = '';
    priceFilter.value = '';
    seasonFilter.value = '';
    filterTours();
  });
});
</script>
{{ end }}
