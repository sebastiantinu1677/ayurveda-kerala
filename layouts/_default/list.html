{{ define "main" }}
<section class="max-w-6xl mx-auto pt-1 pb-3 px-4">
  <h1 class="section-title">Unsere Reisen</h1>
  <p class="section-subtitle">Entdecken Sie unsere vielfältigen Kerala-Reisen für jeden Geschmack und jedes Budget</p>
  

  <!-- Filter System -->
  <div class="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-6 sm:mb-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg sm:text-xl font-bold">Reisen filtern</h2>
      <button id="filter-toggle" class="md:hidden text-gray-600 hover:text-gray-800">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>
    </div>
    <div id="filter-content" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 hidden md:grid">
      <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Kategorie</label>
        <select id="categoryFilter" class="w-full border border-gray-300 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Kategorien</option>
          <option value="ayurveda">Ayurveda-Kuren</option>
          <option value="yoga">Yoga-Retreats</option>
          <option value="rundreise">Rundreisen</option>
          <option value="wellness">Wellness</option>
        </select>
      </div>
      
      <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Dauer</label>
        <select id="durationFilter" class="w-full border border-gray-300 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Dauer</option>
          <option value="7">7 Tage</option>
          <option value="14">14 Tage</option>
          <option value="21">21 Tage</option>
          <option value="28">28+ Tage</option>
        </select>
      </div>
      
      <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Preis</label>
        <select id="priceFilter" class="w-full border border-gray-300 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Preise</option>
          <option value="0-1000">bis 1.000€</option>
          <option value="1000-2000">1.000€ - 2.000€</option>
          <option value="2000-3000">2.000€ - 3.000€</option>
          <option value="3000+">ab 3.000€</option>
        </select>
      </div>
      
      <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Saison</label>
        <select id="seasonFilter" class="w-full border border-gray-300 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Jahreszeiten</option>
          <option value="winter">Winter (Dez-Feb)</option>
          <option value="spring">Frühling (Mär-Mai)</option>
          <option value="summer">Sommer (Jun-Aug)</option>
          <option value="autumn">Herbst (Sep-Nov)</option>
        </select>
      </div>
    </div>
    
    <div class="mt-3 sm:mt-4 flex justify-between items-center">
      <button id="clearFilters" class="text-gray-500 hover:text-gray-700 text-xs sm:text-sm">Filter zurücksetzen</button>
      <span id="resultCount" class="text-xs sm:text-sm text-gray-600">{{ len .Pages }} Reisen gefunden</span>
    </div>
  </div>
  
  <!-- Tours Grid -->
  <div id="toursGrid" class="grid md:grid-cols-3 gap-8">
    {{ $sortedPages := sort .Pages "Params.weight" "asc" }}
    {{ range $sortedPages }}
      <div class="tour-card bg-white rounded-lg shadow card-enhanced" 
           data-category="{{ .Params.categories | default (slice) | jsonify }}"
           data-duration="{{ .Params.duration }}"
           data-price="{{ .Params.pricefrom }}"
           data-season="{{ .Params.bestSeason }}">
        <a href="{{ .RelPermalink }}" class="block">
          {{ with .Params.image }}
            {{ partial "picture.html" (dict "src" . "alt" $.Title "class" "w-full h-40 object-cover rounded-t-lg" "loading" "lazy") }}
          {{ end }}
          <div class="p-6">
            <h2 class="card-title">{{ .Title }}</h2>
            <p class="card-description">{{ .Description }}</p>
            
            <!-- Tour Details -->
            <div class="flex flex-wrap gap-2 mb-4">
              {{ with .Params.duration }}
                <span class="badge-secondary bg-blue-100 text-blue-800 px-3 py-1 rounded-full">{{ . }}</span>
              {{ end }}
              {{ with .Params.pricefrom }}
                <span class="badge-secondary bg-green-100 text-green-800 px-3 py-1 rounded-full price-small">{{ . }}€ p.P.</span>
              {{ end }}
              {{ with .Params.categories }}
                {{ range first 1 . }}
                  <span class="badge-secondary bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full">{{ . }}</span>
                {{ end }}
              {{ end }}
            </div>
            
            <div class="link-primary text-sm">
              Mehr erfahren →
            </div>
          </div>
        </a>
      </div>
    {{ end }}
  </div>
</section>

<style>
/* Mobile filter styles */
@media (max-width: 768px) {
  #filter-content {
    transition: all 0.3s ease;
  }
  
  #filter-content.hidden {
    display: none !important;
  }
  
  #filter-content:not(.hidden) {
    display: grid !important;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const categoryFilter = document.getElementById('categoryFilter');
  const durationFilter = document.getElementById('durationFilter');
  const priceFilter = document.getElementById('priceFilter');
  const seasonFilter = document.getElementById('seasonFilter');
  const clearFilters = document.getElementById('clearFilters');
  const resultCount = document.getElementById('resultCount');
  const toursGrid = document.getElementById('toursGrid');
  const tourCards = document.querySelectorAll('.tour-card');
  
  function filterTours() {
    const category = categoryFilter.value.toLowerCase();
    const duration = durationFilter.value;
    const price = priceFilter.value;
    const season = seasonFilter.value;
    
    let visibleCount = 0;
    
    tourCards.forEach(card => {
      let show = true;
      
      // Category filter
      if (category) {
        const cardCategories = JSON.parse(card.dataset.category || '[]');
        show = show && cardCategories.some(cat => cat.toLowerCase().includes(category));
      }
      
      // Duration filter
      if (duration && show) {
        const cardDuration = card.dataset.duration;
        if (duration === '7') show = show && cardDuration && cardDuration.includes('7');
        else if (duration === '14') show = show && cardDuration && cardDuration.includes('14');
        else if (duration === '21') show = show && cardDuration && cardDuration.includes('21');
        else if (duration === '28') show = show && cardDuration && parseInt(cardDuration) >= 28;
      }
      
      // Price filter
      if (price && show) {
        const cardPrice = parseInt(card.dataset.price) || 0;
        if (price === '0-1000') show = show && cardPrice <= 1000;
        else if (price === '1000-2000') show = show && cardPrice > 1000 && cardPrice <= 2000;
        else if (price === '2000-3000') show = show && cardPrice > 2000 && cardPrice <= 3000;
        else if (price === '3000+') show = show && cardPrice > 3000;
      }
      
      // Season filter
      if (season && show) {
        const cardSeason = card.dataset.season;
        show = show && cardSeason && cardSeason.toLowerCase().includes(season);
      }
      
      if (show) {
        card.style.display = 'block';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });
    
    resultCount.textContent = `${visibleCount} Reisen gefunden`;
  }
  
  // Event listeners
  [categoryFilter, durationFilter, priceFilter, seasonFilter].forEach(filter => {
    filter.addEventListener('change', filterTours);
  });
  
  clearFilters.addEventListener('click', function() {
    categoryFilter.value = '';
    durationFilter.value = '';
    priceFilter.value = '';
    seasonFilter.value = '';
    filterTours();
  });

  // Mobile filter toggle
  const filterToggle = document.getElementById('filter-toggle');
  const filterContent = document.getElementById('filter-content');
  
  if (filterToggle && filterContent) {
    filterToggle.addEventListener('click', function() {
      const isHidden = filterContent.classList.contains('hidden');
      
      if (isHidden) {
        // Show filters on mobile
        filterContent.classList.remove('hidden');
        filterContent.classList.add('block');
      } else {
        // Hide filters on mobile
        filterContent.classList.add('hidden');
        filterContent.classList.remove('block');
      }
      
      // Rotate arrow
      const arrow = filterToggle.querySelector('svg');
      arrow.style.transform = filterContent.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
      arrow.style.transition = 'transform 0.2s ease';
    });
  }
});
</script>
{{ end }}
