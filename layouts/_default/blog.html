{{ define "main" }}
<section class="max-w-4xl mx-auto pt-1 pb-3 px-4">
  <h1 class="text-3xl font-bold mb-8">Blog</h1>
  
  <!-- Blog Filter System -->
  <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
    <h2 class="text-lg font-semibold mb-4">Blog-Artikel filtern</h2>
    <div class="grid md:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Kategorie</label>
        <select id="categoryFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Kategorien</option>
          <option value="ayurveda">Ayurveda</option>
          <option value="yoga">Yoga</option>
          <option value="reiseplanung">Reiseplanung</option>
          <option value="kultur">Kultur</option>
          <option value="rezepte">Rezepte</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Thema</label>
        <select id="topicFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="">Alle Themen</option>
          <option value="tipps">Tipps & Tricks</option>
          <option value="checkliste">Checklisten</option>
          <option value="rezepte">Rezepte</option>
          <option value="kultur">Kulturelle Hinweise</option>
          <option value="packliste">Packlisten</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Sortierung</label>
        <select id="sortFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
          <option value="newest">Neueste zuerst</option>
          <option value="oldest">Älteste zuerst</option>
          <option value="title">Nach Titel</option>
        </select>
      </div>
    </div>
    
    <div class="mt-4 flex justify-between items-center">
      <button id="clearFilters" class="text-gray-500 hover:text-gray-700 text-sm">Filter zurücksetzen</button>
      <span id="resultCount" class="text-sm text-gray-600">{{ len .Pages }} Artikel gefunden</span>
    </div>
  </div>
  
  <!-- Blog Posts Grid -->
  <div id="blogGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
    {{ range .Pages }}
      <article class="blog-card bg-white rounded-lg shadow hover:shadow-lg transition" 
               data-category="{{ .Params.categories | default (slice) | jsonify }}"
               data-tags="{{ .Params.tags | default (slice) | jsonify }}"
               data-date="{{ .Date.Format "2006-01-02" }}"
               data-title="{{ .Title | lower }}">
        <a href="{{ .RelPermalink }}" class="block">
          {{ with .Params.image }}
            {{ partial "picture.html" (dict "src" . "alt" $.Title "class" "w-full h-48 object-cover rounded-t-lg" "loading" "lazy") }}
          {{ end }}
          <div class="p-6">
            <div class="flex items-center text-sm text-gray-500 mb-2">
              <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2. January 2006" }}</time>
              {{ with .Params.categories }}
                <span class="mx-2">•</span>
                <span>{{ index . 0 }}</span>
              {{ end }}
            </div>
            
            <h2 class="text-xl font-semibold mb-3 text-gray-900">{{ .Title }}</h2>
            <p class="text-gray-600 text-sm mb-4">{{ .Summary | truncate 120 }}</p>
            
            <!-- Blog Tags -->
            <div class="flex flex-wrap gap-2 mb-4">
              {{ with .Params.tags }}
                {{ range first 2 . }}
                  <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded">{{ . }}</span>
                {{ end }}
              {{ end }}
            </div>
            
            <div class="text-yellow-600 font-semibold text-sm">
              Weiterlesen →
            </div>
          </div>
        </a>
      </article>
    {{ end }}
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const categoryFilter = document.getElementById('categoryFilter');
  const topicFilter = document.getElementById('topicFilter');
  const sortFilter = document.getElementById('sortFilter');
  const clearFilters = document.getElementById('clearFilters');
  const resultCount = document.getElementById('resultCount');
  const blogGrid = document.getElementById('blogGrid');
  const blogCards = document.querySelectorAll('.blog-card');
  
  function filterBlogPosts() {
    const category = categoryFilter.value.toLowerCase();
    const topic = topicFilter.value.toLowerCase();
    const sort = sortFilter.value;
    
    let visiblePosts = [];
    
    blogCards.forEach(card => {
      let show = true;
      
      // Category filter
      if (category) {
        const cardCategories = JSON.parse(card.dataset.category || '[]');
        show = show && cardCategories.some(cat => cat.toLowerCase().includes(category));
      }
      
      // Topic filter
      if (topic && show) {
        const cardTags = JSON.parse(card.dataset.tags || '[]');
        show = show && cardTags.some(tag => tag.toLowerCase().includes(topic));
      }
      
      if (show) {
        card.style.display = 'block';
        visiblePosts.push(card);
      } else {
        card.style.display = 'none';
      }
    });
    
    // Sort visible posts
    if (sort === 'newest') {
      visiblePosts.sort((a, b) => new Date(b.dataset.date) - new Date(a.dataset.date));
    } else if (sort === 'oldest') {
      visiblePosts.sort((a, b) => new Date(a.dataset.date) - new Date(b.dataset.date));
    } else if (sort === 'title') {
      visiblePosts.sort((a, b) => a.dataset.title.localeCompare(b.dataset.title));
    }
    
    // Reorder in DOM
    visiblePosts.forEach(card => {
      blogGrid.appendChild(card);
    });
    
    resultCount.textContent = `${visiblePosts.length} Artikel gefunden`;
  }
  
  // Event listeners
  [categoryFilter, topicFilter, sortFilter].forEach(filter => {
    filter.addEventListener('change', filterBlogPosts);
  });
  
  clearFilters.addEventListener('click', function() {
    categoryFilter.value = '';
    topicFilter.value = '';
    sortFilter.value = 'newest';
    filterBlogPosts();
  });
});
</script>
{{ end }}
